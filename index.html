<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">






  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">



















  
  
  
  

  
    
    
  

  

  
    
      
    

    
  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic|18:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=6.0.6" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.0.6">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.0.6">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.0.6">


  <link rel="mask-icon" href="/images/logo.svg?v=6.0.6" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '6.0.6',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://diffnest.github.io/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">






  <link rel="canonical" href="http://diffnest.github.io/">



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Hexo</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> 

<div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Hexo</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        
          
  <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>
</li>

      
        
        
          
  <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>
</li>

      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>Search</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="Searching..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>


  



 </div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://diffnest.github.io/2018/12/04/rsa/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/04/rsa/" itemprop="url">php 使用openssl进行RSA2加解密以及签名算法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-12-04T19:36:53+08:00">2018-12-04</time>
            

            
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>在对接玖富债权项目中，用到了RSA加解密算法，特此记录下；</p>
</blockquote>
<ol>
<li><p>公私钥成对出现，相互解密；<br> 公钥加密，私钥解密。<br> 私钥数字签名，公钥验证。</p>
</li>
<li><p>生成RSA秘钥对，主要利用linux OPENSSL</p>
<p> 2.1 生成RSA私钥 <br></p>
<pre><code><figure class="highlight plain"><figcaption><span>-out rsa_private_key.pem 1024```</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">	</span><br><span class="line">2.2 把RSA私钥转换成PKCS8格式&lt;/br&gt;</span><br><span class="line">	```pkcs8 -topk8 -inform PEM -in rsa_private_key.pem -outform PEM –nocrypt</span><br></pre></td></tr></table></figure>
</code></pre></li>
</ol>
<pre><code>2.3 生成RSA公钥&lt;/br&gt;
    <figure class="highlight plain"><figcaption><span>-in rsa_private_key.pem -pubout -out rsa_public_key.pem```</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">		</span><br><span class="line">	&gt;打开rsa_public_key.pem可以看到-----BEGIN PUBLIC KEY-----开头，</span><br><span class="line">		-----END PUBLIC KEY-----结尾的没有换行的字符串，这个就是公钥</span><br><span class="line">	</span><br><span class="line">3. PHP中实现加解密类</span><br></pre></td></tr></table></figure>
</code></pre><p>class RSA {</p>
<pre><code>private $pubKey = null;
private $priKey = null;

/**
* 构造函数
* @param string 公钥文件（验签和加密时传入）
* @param string 私钥文件（签名和解密时传入）
*/
public function __construct($pubKeyFile = &apos;&apos;, $priKeyFile = &apos;&apos;)
{
    if ($pubKeyFile) {
        $this-&gt;pubKey = $this-&gt;getFileContent($pubKeyFile);
    }
    if ($priKeyFile) {
        $this-&gt;priKey = $this-&gt;getFileContent($priKeyFile);
    }
}

/**
 * RSA签名
 * @param $data 待签名数据
 * @param $priKey 商户私钥文件路径 或 密钥内容本身
 * return $sign 签名结果
 */
public function sign($data, $code = &apos;base64&apos;) 
{
    $result = openssl_get_privatekey($this-&gt;priKey);
    if (openssl_sign($data, $sign, $result)) {
        openssl_free_key($result);
        $sign = $this-&gt;encode($sign, $code);
    }
    return $sign;
}

/**
* 验证签名
* @param $data 待签名数据
* @param $sign 要校对的的签名结果
* @param string 签名编码（base64/hex/bin）
* @return bool
*/
public function verify($data, $sign, $code = &apos;base64&apos;)
{
    $ret = false;
    $result = openssl_get_publickey($this-&gt;pubKey);
    $sign = $this-&gt;decode($sign, $code);
    if ($sign !== false) {
        $ret = (bool) openssl_verify($data, $sign, $result); 
        openssl_free_key($result);
    }
    return $ret;
}

/**
 * RSA加密
 * @param $content 需要加密的内容
 * @param $this-&gt;pubKey 商户公钥文件路径 或 密钥内容本身
 * return 加密后内容，明文
 */
public function encrypt($content, $code = &apos;base64&apos;)
{
    $result = openssl_get_publickey($this-&gt;pubKey);
    $rslt = &apos;&apos;;
    for ($i = 0; $i &lt; ((strlen($content)-strlen($content)%117) / 117 + 1); $i++) {
        $data = mb_strcut($content, $i * 117, 117, &apos;utf-8&apos;);
        openssl_public_encrypt($data, $encrypted, $result);
        $rslt .= $encrypted;
    }
    openssl_free_key($result);
    $rslt = $this-&gt;encode($rslt, $code);
    return $rslt;
}

/**
 * RSA解密
 * @param $content 需要解密的内容，密文
 * @param $this-&gt;priKey 商户私钥文件路径 或 密钥内容本身
 * return 解密后内容，明文
 */
public function decrypt($content, $code = &apos;base64&apos;)
{
    $result = openssl_get_privatekey($this-&gt;priKey);
    $content = $this-&gt;decode($content, $code);
    $rslt = &apos;&apos;;
    for ($i = 0; $i &lt; strlen($content)/128; $i++) {
        $data = substr($content, $i * 128, 128);
        openssl_private_decrypt($data, $decrypt, $result);
        $rslt .= $decrypt;
    }
    openssl_free_key($result);
    return $rslt;
}

private function encode($data, $code)  
{
    switch (strtolower($code)) {
        case &apos;base64&apos;:
            $data = base64_encode(&apos;&apos;.$data);
        break;
    }
    return $data;
}

private function decode($data, $code)
{
    switch (strtolower($code)) {
        case &apos;base64&apos;:
            $data = base64_decode($data);
        break;
    }
    return $data;
}

private function getFileContent($file)   
{
    if (file_exists($file)) {
        return file_get_contents($file);
    }
    return $file;
}
</code></pre><p>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">4.代码中具体调用：</span><br></pre></td></tr></table></figure></p>
<p>/**</p>
<pre><code> * 同步债权信息
 * @param $orderNo 订单ID
 * @param $memberId 玖富理财用户ID
 * @return boolen
 */
function syncRepayPlan($sDate, $eDate)
{
    if (!$sDate || !$eDate) {
        return false;
    }
    $data = array(&apos;inputCharset&apos; =&gt; jiufuStatus::JIUFU_INPUTCHARSET,
        &apos;version&apos; =&gt; jiufuStatus::JIUFU_VERSION,
        &apos;channelId&apos; =&gt; jiufuStatus::JIUFU_CHANNELID,
        &apos;startTime&apos; =&gt; $sDate,
        &apos;endTime&apos; =&gt; $eDate,
    );
    $requestNo = sprintf(&quot;%d:&apos;%s&apos;:&apos;%s&apos;&quot;,
        jiufuStatus::REQTYPE_JIUFU_RSYNC_REPAY_PLAN, &apos;jiufuSyncRepayPlan&apos;, uniqid());
    $dataString = json_encode($data);
    $info = array(
        &apos;requestno&apos; =&gt; $requestNo,
        &apos;type&apos; =&gt; jiufuStatus::REQTYPE_JIUFU_RSYNC_REPAY_PLAN,
        &apos;reqtime&apos; =&gt; CMI_DATE_NOW,
        &apos;data&apos; =&gt; $dataString
    );
    $r = $this-&gt;xdReqst-&gt;createRequest($requestNo,
        jiufuStatus::REQTYPE_JIUFU_RSYNC_REPAY_PLAN, $info);
    if ($r) {
        $rslt = $this-&gt;excuteReq(__FUNCTION__, $data);
        return $this-&gt;handleRepayPlan($requestNo, $rslt);
    }
}

/**
 * 处理还款计划
 * @param $requestNo 请求ID
 * @param $rslt
 * @return boolen
 */
function handleRepayPlan($requestNo, $rslt)
{
    if ($rslt[&apos;returnCode&apos;] != &apos;0000&apos; || empty($rslt[&apos;responseData&apos;])) {
        printf(&apos;获取还款计划失败%s&apos;, $rslt[&apos;returnMessage&apos;]);
        $this-&gt;errorMsg(__LINE__. $error);
    }
    $dataList = $rslt[&apos;responseData&apos;];
    foreach ($dataList as $key =&gt; &amp;$value) {
        $value[&apos;channelId&apos;] = $rslt[&apos;channelId&apos;];
    }
    $classFun = __FUNCTION__;
    $handleObj = new handleData();
    $handleObj-&gt;valList = $dataList;
    $r = $handleObj-&gt;$classFun();
    if ($r[&apos;Status&apos;] == &apos;Fail&apos;) {
        $error = $r[&apos;Message&apos;];
        $this-&gt;xdReqst-&gt;updateRequest($requestNo,
            REQSTATUS_FAILED, array(&apos;data&apos; =&gt; $data, &apos;errorMsg&apos; =&gt; $error));
        $this-&gt;errorMsg(__LINE__. $error);
        return false;
    }
    $this-&gt;xdReqst-&gt;updateRequest($requestNo, REQSTATUS_SUCCESS, $r);
    return true;
}

/**
* 发送请求
* @param $reqName 请求名称
* @param $data 请求数据
* @return array
*/
public function excuteReq($reqName, $data = null)
{
    $rsaObj = new rsa(PUBLIC_KEY_PATH, PRIVATE_KEY_PATH);

    //加密加签
    $secretData = $rsaObj-&gt;encrypt(json_encode($data));
    $secretSign = $rsaObj-&gt;sign(base64_decode($secretData));

    //请求接口
    $rslt = $this-&gt;proxy-&gt;$reqName(array(&apos;data&apos; =&gt; $secretData, &apos;sign&apos; =&gt; $secretSign));
    if (!$rsaObj-&gt;verify(base64_decode($rslt[&apos;data&apos;]), $rslt[&apos;sign&apos;])) {
        $error = sprintf(&quot;验签失败&quot;);
        $this-&gt;errorMsg(__LINE__. $error);
    }

    //解密接口返回数据
    $rsltData = $rsaObj-&gt;decrypt($rslt[&apos;data&apos;]);
    return json_decode($rsltData, true);
}
</code></pre><p><code>`</code></p>

          
        
      
    </div>

    
    
    <div>
      
    </div>

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://diffnest.github.io/2018/12/03/hello-world/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/03/hello-world/" itemprop="url">Hello World</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-12-03T19:12:07+08:00">2018-12-03</time>
            

            
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>

          
        
      
    </div>

    
    
    <div>
      
    </div>

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://diffnest.github.io/2018/01/08/reflect/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/08/reflect/" itemprop="url">Untitled</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-01-08T19:33:45+08:00">2018-01-08</time>
            

            
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="反射类应该怎么用？？"><a href="#反射类应该怎么用？？" class="headerlink" title="反射类应该怎么用？？"></a>反射类应该怎么用？？<br></h2><blockquote>
<p>很久之前用过关于反射相关的函数，一直没时间整理，趁下班等巴士的这段时间，整理下</p>
</blockquote>
<hr>
<p>###1.反射是什么？<br><br>它是指在PHP运行状态中，扩展分析PHP程序，导出或提取出关于类、方法、属性、参数等的详细信息，包括注释。这种动态获取的信息以及动态调用对象的方法的功能称为反射API。<br>反射是操纵面向对象范型中元模型的API，其功能十分强大，可帮助我们构建复杂，可扩展的应用。</p>
<p>###2. 反射应用场景</p>
<blockquote>
<ul>
<li>生成文档（生成代码文档，方便查阅）</li>
<li>自动加载插件（使用加载的配置类，比如系统的配置文件，过滤常量）</li>
<li>加载第三方封装类库（加载类库，调用相关方法）</li>
</ul>
</blockquote>
<p>###3. 实例代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    abstract class Module &#123;    #核心Module类库</span><br><span class="line">        function baseFunc() &#123;</span><br><span class="line">            echo &quot;I am baseFunc&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        abstract function execute();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    class ModuleRunner </span><br><span class="line">    &#123;</span><br><span class="line">        #模拟xml配置，动态配置需要加载的Module</span><br><span class="line">        private $C = array (    </span><br><span class="line">            &quot;PersonModule&quot; =&gt; array(&quot;person&quot; =&gt; &quot;bob&quot;),</span><br><span class="line">            &quot;FtpModule&quot; =&gt; array(&quot;host&quot; =&gt; &quot;example.com&quot;, &quot;user&quot; =&gt; &quot;anon&quot;)</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        private $modules = array();</span><br><span class="line">        </span><br><span class="line">        #初始化ModuleRunner，加载配置中的Module</span><br><span class="line">        function init() </span><br><span class="line">        &#123;   </span><br><span class="line">            $parent = new ReflectionClass(&quot;Module&quot;);</span><br><span class="line">            foreach($this-&gt;C as $cName =&gt; $params) </span><br><span class="line">            &#123;    </span><br><span class="line">                #检查配置中的Module是否合法</span><br><span class="line">                $mClass = new ReflectionClass($cName);</span><br><span class="line">                #检查是否是Module的子类型</span><br><span class="line">		        if(! $mClass-&gt;isSubclassOf($parent)) &#123;    </span><br><span class="line">                    throw new Exception(&quot;unknown type : &#123;$cName&#125;&quot;);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                $module = $mClass-&gt;newInstance();</span><br><span class="line">                #检查配置中的函数的参数格式是否正确</span><br><span class="line">                foreach($mClass-&gt;getMethods() as $method) </span><br><span class="line">                &#123;   </span><br><span class="line">                    $this-&gt;handleMothod($module, $method, $params);</span><br><span class="line">                &#125;</span><br><span class="line">                #加载Module</span><br><span class="line">                array_push($this-&gt;modules, $module);   </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        #检查Module中的方法参数是否和传入的$params名字相同,并且具有set方法</span><br><span class="line">        private function handleMothod(Module $module, ReflectionMethod $method, $params) </span><br><span class="line">        &#123;    </span><br><span class="line">  </span><br><span class="line">            $name = $method-&gt;getName();</span><br><span class="line">            $args = $method-&gt;getParameters();</span><br><span class="line"></span><br><span class="line">            #如果没有配置中的类的方法的参数个数不为1,或者方法名前3个字母不为set,返回false</span><br><span class="line">            if(count($args) != 1 || substr($name, 0, 3) != &quot;set&quot;) &#123;    </span><br><span class="line">                return false;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            #如果方法名后三个字母与配置中的参数名不同,返回false</span><br><span class="line">            $property = strtolower(substr($name, 3));</span><br><span class="line">            if(!isset($params[$property])) &#123;    </span><br><span class="line">                return false;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            #获取参数的类型</span><br><span class="line">            $argClass = $args[0]-&gt;getClass();    </span><br><span class="line"></span><br><span class="line">            if (empty($argClass)) &#123;</span><br><span class="line">                #参数无类型限制则直接调用set方法</span><br><span class="line">                $method-&gt;invoke($module, $params[$property]);   </span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                #有类型限制则新建一个实例并调用set方法</span><br><span class="line">                $method-&gt;invoke($module, $argClass-&gt;newInstance($params[$property]));    #</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        public function getModules() </span><br><span class="line">        &#123;</span><br><span class="line">            return $this-&gt;modules;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    class Person &#123;    #第三方类</span><br><span class="line">        public $name;</span><br><span class="line">        </span><br><span class="line">        function __construct($name) &#123;</span><br><span class="line">            $this-&gt;name = $name;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    class FtpModule extends Module &#123;    #用户自定义第三方Module</span><br><span class="line">        private $host = &quot;default host&quot;;</span><br><span class="line">        private $user = &quot;default user&quot;;</span><br><span class="line">        </span><br><span class="line">        function setHost($host) &#123;</span><br><span class="line">            $this-&gt;host = $host;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        function setUser($user) &#123;</span><br><span class="line">            $this-&gt;user = $user;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        function execute() &#123;</span><br><span class="line">            echo &quot;&#123;$this-&gt;user&#125; user &#123;$this-&gt;host&#125;&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    class PersonModule extends Module &#123;    #用户自定义第三方Module</span><br><span class="line">        private $person;</span><br><span class="line">    </span><br><span class="line">        function setPerson(Person $person) &#123;</span><br><span class="line">            $this-&gt;person = $person;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        function execute() &#123;</span><br><span class="line">            if(isset($person)) &#123;</span><br><span class="line">                echo &quot;I am &#123;$this-&gt;person-&gt;name&#125;&quot;;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                echo &quot;I am no user&quot;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    $modRunner = new ModuleRunner();</span><br><span class="line">    $modRunner-&gt;init();</span><br><span class="line">//    var_dump($modRunner);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    
    
    <div>
      
    </div>

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://diffnest.github.io/2017/12/27/实战/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/27/实战/" itemprop="url">Untitled</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-12-27T18:35:23+08:00">2017-12-27</time>
            

            
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>###AWK 实战<br></p>
<blockquote>
<p>产品的统计需求不断在增加，记录下操作过程吧~~~</p>
</blockquote>
<h5 id="1-批量杀死进程"><a href="#1-批量杀死进程" class="headerlink" title="1.批量杀死进程"></a>1.批量杀死进程</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | grep php-fpm | awk &apos;&#123;printf &quot;sudo kill %d\n&quot;, $2&#125;&apos; | sh</span><br></pre></td></tr></table></figure>
<h5 id="2-统计近90天登录的用户，归类（30-60-90-120）"><a href="#2-统计近90天登录的用户，归类（30-60-90-120）" class="headerlink" title="2. 统计近90天登录的用户，归类（30,60,90,120）"></a>2. 统计近90天登录的用户，归类（30,60,90,120）</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">原数据</span><br><span class="line">162273212 18999203664 A1 1513067824</span><br><span class="line">162846154 18976991999 A1 1494338665</span><br><span class="line">151600666 18995410638 A1 1499221875</span><br><span class="line">20638558 18978648908  A1 1511334276</span><br><span class="line">118463293 18999207335 A1 1509326286</span><br><span class="line">150911107 18976918588 A1 1502621711</span><br><span class="line"></span><br><span class="line">1.首先得出当前时间戳</span><br><span class="line">	date +%s &gt; 1513148221</span><br><span class="line">2.用当前时间戳 - 最后登录时间 = 时间差</span><br><span class="line">	awk &apos;&#123;if (1513148221-$4 &lt; 86400 * 30) $4=30; else if (1513148221-$4 &gt;= 86400 * 30 &amp;&amp; 1513148221-$4 &lt;= 86400 * 60) $4=60; else if (1513148221-$4 &gt;= 86400 * 60 &amp;&amp; 1513148221-$4 &lt;= 86400 * 90) $4=90;else if (1513148221-$4 &gt; 86400 * 90 )$4=91;print&#125;&apos; jf.src &gt; /tmp/wdk</span><br><span class="line"></span><br><span class="line">//带括号的ifelse</span><br><span class="line">awk &apos;&#123; if ($2 &gt;= 90 &amp;&amp; $2 &lt;= 100) &#123;print $1,&quot;A&quot;&#125; else if ($2 &gt;= 80 &amp;&amp; $2 &lt; 90) &#123;print $1,&quot;B&quot;&#125; else if ($2 &gt;= 70 &amp;&amp; $2 &lt; 80) &#123;print $1,&quot;C&quot;&#125; else if ($2 &gt;= 60 &amp;&amp; $2 &lt; 70) &#123;print $1,&quot;D&quot;&#125; else &#123;print $1,&quot;E&quot;&#125; &#125;&apos; cj</span><br></pre></td></tr></table></figure>
<p>#####3. 统计文本中同一数据出现的次数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1. awk &apos;&#123;a[$2]++&#125;END&#123;for(i in a)print i,a[i]&#125;&apos; iosA1_tj.txt</span><br><span class="line">   1.1 相同数累加，取出对应的key =&gt; value</span><br><span class="line"></span><br><span class="line">2. awk &apos;&#123;print $2&#125;&apos; iosA1_tj.txt | sort | uniq -c | sort -nr | head -n 2</span><br><span class="line">	2.1 先排序然后uniq -c （在每列旁边显示该行重复出现的次数） </span><br><span class="line">	2.2 sort -nr (要以数值来排序)</span><br><span class="line">	2.3 head -n 2(取出最前面2个)</span><br></pre></td></tr></table></figure></p>
<h5 id="4-一分为二，切割文本"><a href="#4-一分为二，切割文本" class="headerlink" title="4. 一分为二，切割文本"></a>4. 一分为二，切割文本</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">split [-bl] file [prefix]</span><br><span class="line">参数说明：</span><br><span class="line">-b, --bytes=SIZE：对file进行切分，每个小文件大小为SIZE。可以指定单位b,k,m。</span><br><span class="line">-l, --lines=NUMBER：对file进行切分，每个文件有NUMBER行。</span><br><span class="line">	</span><br><span class="line">prefix：分割后产生的文件名前缀。</span><br><span class="line">	</span><br><span class="line">假设要切分的文件为tj_001，大小10M，10000行。</span><br><span class="line">	</span><br><span class="line">split -l 5000 test.2012-08-16_17</span><br><span class="line">生成xaa，xab，xac三个文件</span><br><span class="line">	</span><br><span class="line">//指定大小切割</span><br><span class="line">split -b 600k test.2012-08-16_17</span><br><span class="line">split -b 500k test.2012-08-16_17 example</span><br></pre></td></tr></table></figure>
<h5 id="5-匹配比较指定文本内容"><a href="#5-匹配比较指定文本内容" class="headerlink" title="5. 匹配比较指定文本内容"></a>5. 匹配比较指定文本内容</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">1.利用NR FNR 两个文件行级比较</span><br><span class="line">awk &apos;NR==FNR&#123;a[$1]=$1&quot; &quot;$2 &quot; &quot;$6&quot; &quot;$7&quot; &quot;$8&#125;NR!=FNR&#123;if($1 in a)print a[$1]&#125;&apos; ios.new iosA1_new.txt</span><br><span class="line"> </span><br><span class="line">2.comm 比较 </span><br><span class="line">comm [-123][--help][--version][第1个文件][第2个文件]</span><br><span class="line">比如：a.txt </span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">b.txt</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">找出a.txt文件有而b.txt文件中没有的放在c.txt文件中</span><br><span class="line">#!/bin/sh  </span><br><span class="line">#BEGIN  </span><br><span class="line">	cat a.txt | sort | uniq | sort &gt; a_u.txt  </span><br><span class="line">	cat b.txt | sort | uniq | sort &gt; b_u.txt  </span><br><span class="line">	comm -23  a_u.txt  b_u.txt &gt; c.txt  </span><br><span class="line"># END  </span><br><span class="line"> </span><br><span class="line">3. diff比较 </span><br><span class="line">找出a.txt文件有而b.txt文件中没有的放在c.txt文件中</span><br><span class="line"></span><br><span class="line">比较文件的差异</span><br><span class="line">#!/bin/sh  </span><br><span class="line">#BEGIN  </span><br><span class="line">	cat a.txt | sort | uniq | sort &gt; a_u.txt  </span><br><span class="line">	cat b.txt | sort | uniq | sort &gt; b_u.txt  </span><br><span class="line">	diff   a_u.txt  b_u.txt | grep /&lt;  | awk &apos; $1 = &quot; &quot; &apos; &gt; c.txt  </span><br><span class="line"># END</span><br></pre></td></tr></table></figure>
<h5 id="6-补充："><a href="#6-补充：" class="headerlink" title="6. 补充："></a>6. 补充：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">两个文件并删除相同部分</span><br><span class="line">方法一：</span><br><span class="line">　　comm -23 file1 file2</span><br><span class="line">方法二：</span><br><span class="line">　　grep -v -f file1 file2</span><br><span class="line">　　/*注：：此法在对比数字时候比较凑效果，文本对比不建议使用*/</span><br><span class="line">方法三：</span><br><span class="line">	awk &apos;&#123;print NR，$0&#125;&apos; file1 file2 |sort -k2|uniq -u -f 1|sort -k1|awk &apos;&#123;print $2&#125;&apos;</span><br><span class="line">　　或者：</span><br><span class="line">　　awk &apos;&#123;print $0&#125;&apos; file1 file2 |sort|uniq -u</span><br><span class="line"></span><br><span class="line">1、统计两个文本文件的相同行</span><br><span class="line">grep -Ff file1 file2</span><br><span class="line"></span><br><span class="line">2、统计file1中有，file2中没有的行</span><br><span class="line">grep -vFf file1 file2</span><br><span class="line">grep -Fvxf &lt;(grep -Fxf file1 file2 ) file1 file2</span><br><span class="line"></span><br><span class="line">如何比较两个文件并去删除相同的内容</span><br><span class="line">for i in $(&lt;file1); do grep $i file2 || echo $i &gt;&gt;tmp1 ; done</span><br><span class="line"></span><br><span class="line">输出相同行：</span><br><span class="line">$grep -wf file1 file2</span><br><span class="line"></span><br><span class="line">输出不同行</span><br><span class="line">$grep -wvf file1 file2</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    
    
    <div>
      
    </div>

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://diffnest.github.io/2017/12/20/lftp/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/20/lftp/" itemprop="url">Untitled</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-12-20T15:34:08+08:00">2017-12-20</time>
            

            
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="lftp-常用操作"><a href="#lftp-常用操作" class="headerlink" title="lftp 常用操作"></a>lftp 常用操作</h1><h5 id="1-登录lftp"><a href="#1-登录lftp" class="headerlink" title="1.登录lftp"></a>1.登录lftp<br></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lftp -u 用户名,密码 sftp://IP地址 :端口号</span><br></pre></td></tr></table></figure>
<h5 id="2-乱码问题解决"><a href="#2-乱码问题解决" class="headerlink" title="2.乱码问题解决"></a>2.乱码问题解决<br></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">set ftp:charset gbk(或者 gb2312 或 utf-8) ##设置ftp端的编码格式</span><br><span class="line">set file:charset utf-8 (...同上) ##设置本地编码格式</span><br></pre></td></tr></table></figure>
<h5 id="3-查找ftp端文件"><a href="#3-查找ftp端文件" class="headerlink" title="3.查找ftp端文件"></a>3.查找ftp端文件</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ls *.txt ##查找当前目录下的所有txt文件</span><br><span class="line">ls ./123/ ##列出123目录下所有文件</span><br><span class="line">find . -name &quot;*.txt&quot;   ##递归查找站点上所有的txt文件</span><br><span class="line">find ./xx -name &quot;*.txt&quot; ##查找xx目录下所有的txt文件</span><br><span class="line"></span><br><span class="line">附1: ls第二次读取的是本地缓存,可以用 rels 代替 ls 或者catch off / catch on 来开关catch,catch flush清空本地catch</span><br><span class="line">附2: 浏览本地目录的命令可用!ls, 如 !ls /usr/local/bin/</span><br></pre></td></tr></table></figure>
<h5 id="4-下载文件"><a href="#4-下载文件" class="headerlink" title="4.下载文件"></a>4.下载文件</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">下载文件之前要先设置好本地的目录，用来存放下载的文件</span><br><span class="line">lcd /home/123/web   ##设置本地存放目录 默认为 /home/usr</span><br><span class="line"></span><br><span class="line">get 123.txt     ##下载123.txt文件到 /home/123/web 中</span><br><span class="line">get -c 123.txt ##断点续传下载</span><br><span class="line">mget *.txt     ##批量下载所有txt文件</span><br><span class="line">mget -c *.txt ##断点续传</span><br><span class="line">mget -c ./123/aaa/*.txt   ##断点续传、批量下载ftp端aaa目录下的所有txt文件</span><br><span class="line"></span><br><span class="line">pget -c -n 10 file.dat</span><br><span class="line">##以最多10个线程以允许断点续传的方式下载file.dat</span><br><span class="line">##可以通过设置 set pget:default-n 5 的值而使用默认值。</span><br><span class="line"></span><br><span class="line">mirror aaa/</span><br><span class="line">##将aaa目录整个的下载下来，子目录也会自动复制 本地自动建立目录</span><br></pre></td></tr></table></figure>
<h5 id="5-上传文件"><a href="#5-上传文件" class="headerlink" title="5.上传文件"></a>5.上传文件</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">put 123.txt     ##同下载</span><br><span class="line">mput *.txt     ##同下载</span><br><span class="line"></span><br><span class="line">mirror -R aaa/ ##同下载</span><br></pre></td></tr></table></figure>
<h5 id="6-多任务处理"><a href="#6-多任务处理" class="headerlink" title="6.多任务处理"></a>6.多任务处理</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ctrl+z ##将当前进行的任务移交后台处理</span><br><span class="line">wait   ##将后台处理任务调至前台查看</span><br><span class="line">jobs   ##查看后台进行的任务列表</span><br><span class="line">kill all 或者 job_no ##删除所有任务 或 指定的任务</span><br></pre></td></tr></table></figure>
<h4 id="7-lftp-e-在选择后执行命令"><a href="#7-lftp-e-在选择后执行命令" class="headerlink" title="7.lftp -e 在选择后执行命令"></a>7.lftp -e 在选择后执行命令</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lftp -u 用户名,密码  sftp://IP地址 :端口号 -e &quot;ls | wc -l;quit”</span><br><span class="line">lftp -u 用户名,密码  sftp://IP地址 :端口号 -e “mput ;quit“ 传输可以加nohup（不挂断运行）</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    
    
    <div>
      
    </div>

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://diffnest.github.io/2017/07/25/xof/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/07/25/xof/" itemprop="url">Untitled</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-07-25T15:45:03+08:00">2017-07-25</time>
            

            
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>异或加密算法</p>
<blockquote>
<p>对接交易所接口，用到了异或加密算法，心想这么大的交易所，居然用异或加密，不怕给破解了么，不管了，先记录一下吧；</p>
</blockquote>
<p>#####异或：异或（xor）是一个数学运算符。它应用于逻辑运算。异或的数学符号为“⊕”，计算机符号为“xor”。</p>
<ul>
<li>其运算法则为：a⊕b = (¬a ∧ b) ∨ (a ∧¬b)</li>
</ul>
<p>如果a、b两个值不相同，则异或结果为1。如果a、b两个值相同，异或结果为0。</p>
<blockquote>
<p>二进制中：</p>
</blockquote>
<ul>
<li>1 XOR 0 = 1</li>
<li>0 XOR 1 = 1</li>
<li>1 XOR 1 = 0</li>
<li>0 XOR 0 = 0</li>
</ul>
<p>可以看出若两个数相同取0，不同取1<br><br>例：运算11001 ^ 01011 = 10010</p>
<p>如果用其他进制进行运算时，先将他们转化成二进制，再做运算（不足的位在前边填0补齐）<br><br>例：6 ^ 3 = 110 ^ 011 = 101</p>
<p>加解密过程：</p>
<ol>
<li><p>参数说明</p>
<ul>
<li><p>ciphertext:是将身份数据加密后产生的，其由以下数据组成 <br></p>
<pre><code>(1)调用者ip&lt;/br&gt;
(2)特定随机字符串:在express中抽取的部分片段 &lt;/br&gt;
(3)请求时间:请求时间的字符串，格式为”yyyyMMddHHmmss”，&lt;/br&gt;
如201705161452 每个部分之间用字符”-”隔开。&lt;/br&gt;
如:192.168.0.1-T3Qfh-20170608113839&lt;/br&gt;
</code></pre></li>
<li><p>express:是用来解析ciphertext的随机字符串express，其由以下两个部分组成: <br></p>
<pre><code>2.1 随机字符串:随机的20位字符串，在其中抽取出成为ciphertext特定随机字符串的部分。&lt;/br&gt;
2.2 随机数:1-16的随机数。
</code></pre></li>
</ul>
</li>
<li><p>加密过程</p>
<ul>
<li>随机生成一个 20 位的随机字符串和一个 1-16 的随机数，拼装成为 express。<br></li>
<li>根据随机数在随机字符串中抽取相应位置为起始位置的 5 位随机数作为 ciphertext 中的随 机段。<br></li>
<li>将 ip、随机段、调用时间以字符”-”进行分割并按照所述顺序拼合成为明文。<br> </li>
<li>将明文变为 ascii 码，并且每段 ascii 码都和第一步生成的随机数进行异或操作，并且以字 符”-”进行分割。</li>
</ul>
</li>
<li><p>解密说明</p>
<ul>
<li>得到 ciphertext 密文和 express 时，首先解析 express 获得随机数和随机字符段； </li>
<li>然后将 ciphertext 密文中 ascii 码分开并与随机数进行异或运算后，解析为明文获得 ip、随机字 符段和调用时间，并判断 ip 是否为事先定好的 ip 值、随机字段是否与 express 中解析的一致</li>
</ul>
</li>
<li><p>示例说明    </p>
<ul>
<li>随机字符串:FNQQFT3QfhgKRcMThpk</li>
<li>随机数:6</li>
<li>express 值:FNQQFT3QfhgKRcMThpkF6</li>
<li>ip 地址:192.168.0.1</li>
<li>时间:20170608113839</li>
<li>截选的字符串:T3Qfh</li>
<li>明文字符串:192.168.0.1-T3Qfh-20170608113839</li>
<li>getByte 后:495750464954564648464945845181102104455048495548544856494951565157</li>
<li>密文:33-34-35-62-37-39-62-33-40-32-62-37-36-61-70-40-101-34-117-61-34-32-33-39-32-38-35-32-33-38-34-34-32-38-</li>
</ul>
</li>
<li><p>C代码 示例:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">main()</span><br><span class="line">&#123;</span><br><span class="line">   char a[]=&quot;Password&quot;;        //要加密的密码</span><br><span class="line">   char b[]=&quot;encryption&quot;;     //密钥</span><br><span class="line">   int i;</span><br><span class="line">   </span><br><span class="line">   //加密代码</span><br><span class="line">   for(i=0;a[i];i++)</span><br><span class="line">   		a[i]=a[i]^b[i];</span><br><span class="line">   		printf(&quot;Your Password is encrypted: %s\n&quot;,a);</span><br><span class="line">   		</span><br><span class="line">   /*解密代码*/</span><br><span class="line">   for(i=0;a[i];i++)</span><br><span class="line">   		a[i]=a[i]^b[i];</span><br><span class="line">   		printf(&quot;You Password: %s\n&quot;,a);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p> PHP实例代码</p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">$express = &apos;U9rmosZvZcStF5wV8u2e16&apos;;</span><br><span class="line">$ciphertext = &apos;33-34-35-62-37-39-62-33-40-32-62-37-36-61-70-40-101-34-117-61-34-32-33-39-32-38-35-32-33-38-34-34-32-38-&apos;;</span><br><span class="line"></span><br><span class="line">function verifyDecrypt($express, $ciphertext)</span><br><span class="line">   &#123;</span><br><span class="line">       $desObj = new XOR();</span><br><span class="line">       $newString = (string) $desObj-&gt;decrypt($express, $ciphertext);</span><br><span class="line">       </span><br><span class="line">       print_r($newString);</span><br><span class="line">       exit;</span><br><span class="line">       list($ipAddress, $randString, $date) = explode(&apos;-&apos;, $newString);</span><br><span class="line">       if ($ipAddress != &apos;123.57.180.54&apos;) &#123;</span><br><span class="line">           $this-&gt;errorMsg(&apos;ERROR : IP NOT EXIST&apos;);</span><br><span class="line">           return false;</span><br><span class="line">       &#125;</span><br><span class="line">       return true;</span><br><span class="line">   &#125;</span><br><span class="line">调用得到：123.57.180.54-V8u2e-20170630162206</span><br><span class="line"></span><br><span class="line">具体解密代码：</span><br><span class="line">class XOR &#123;</span><br><span class="line">	public function xordecrypt($str, $key)</span><br><span class="line">    &#123;</span><br><span class="line">        $slen = strlen($str);</span><br><span class="line">        $klen = strlen($key);</span><br><span class="line">        for ($i=0; $i &lt; $slen; $i = $i + $klen) &#123;</span><br><span class="line">            $string = substr($str, $i, $klen );</span><br><span class="line">            $xorString .= $key ^ $string;</span><br><span class="line">        &#125;</span><br><span class="line">        return $xorString ? $xorString : &apos;&apos;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function decrypt($express, $ciphertext)</span><br><span class="line">    &#123;</span><br><span class="line">        $express = str_replace(&quot;&apos;&quot;, &quot;&quot;, $express);</span><br><span class="line">        $expressNum = substr($express, 20, 2);</span><br><span class="line"></span><br><span class="line">        $ciphertext = str_replace(&quot;&apos;&quot;, &quot;&quot;, $ciphertext);</span><br><span class="line">        $ciphertextArr = explode(&apos;-&apos;, $ciphertext);</span><br><span class="line">        foreach ($ciphertextArr as $cipher) &#123;</span><br><span class="line">            if (!$cipher) &#123;</span><br><span class="line">            	break;</span><br><span class="line">            &#125;</span><br><span class="line">            //异或运算</span><br><span class="line">            $xordecryptString = $this-&gt;xordecrypt($expressNum, intval($cipher));</span><br><span class="line">            //ASCII转字符串</span><br><span class="line">            $newString .= chr($xordecryptString);</span><br><span class="line">        &#125;</span><br><span class="line">        return $newString;</span><br><span class="line">    &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
</code></pre>
          
        
      
    </div>

    
    
    <div>
      
    </div>

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">John Doe</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">6</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              

              
            </nav>
          

          

          

          
          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>

  

  
</div>




  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/theme-next/hexo-theme-next">NexT.Gemini</a> v6.0.6</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>




















  
  







  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/three.min.js"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/canvas_sphere.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.0.6"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.0.6"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.0.6"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.0.6"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.0.6"></script>



  



	





  





  










  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  
  

  

  

  

  

</body>
</html>
